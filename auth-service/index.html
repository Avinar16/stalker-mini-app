<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Mini App Auth</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div id="status">Аутентификация...</div>

  <script>
    // Получаем подписанную строку от Telegram
    const initData = window.Telegram.WebApp.initData || '';

    // Отправляем на ваш бэкенд
    fetch('https://your-ngrok-address.ngrok.io/auth/verify', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ initData: initData })
    })
    .then(r => r.json())
    .then(data => {
      if (data.user_id) {
        document.getElementById('status').innerText =
          `✅ Успешно! Ваш ID: ${data.user_id}`;
        // Здесь можно сохранить токен или открыть UI
      } else {
        document.getElementById('status').innerText =
          `❌ Ошибка: ${data.detail || 'неизвестно'}`;
      }
    })
    .catch(err => {
      document.getElementById('status').innerText = '❌ Ошибка сети';
      console.error(err);
    });

    // Говорим Telegram, что приложение готово
    window.Telegram.WebApp.ready();
  </script>
</body>
</html>